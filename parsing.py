import sys

import requests
import json
import argparse
from dotenv import load_dotenv
import os
import csv
from datetime import datetime, date, timedelta
from database import insert_data
import mysql.connector

def insert_csv(name, date, severity, description, score, more):
    data = [
    [name, date, severity, description, score, more]
    ]

    with open('cves.csv', mode='a', newline='', encoding='utf-8') as f:
        writer = csv.writer(f, delimiter=';')
        
        for line in data:
            writer.writerow(line)

def insert_json(data):
    with open('cves.json', 'w') as f:
        json.dump(data, f, indent=4)
        
def parse_json(json_response, number, format):
    cve_data = json.loads(json_response.content)

    for cve in cve_data[:number]:
        if format == '2' or format == '3':
            insert_csv(cve['CVE'], cve['public_date'], cve['severity'], cve['bugzilla_description'], cve['cvss_score'],
                       cve['resource_url'])
        insert_data(cve['CVE'], cve['public_date'], cve['severity'], cve['bugzilla_description'],
                    cve['cvss_score'], cve['resource_url'])

    if format == '3' or format == '1':
        insert_json(cve_data)